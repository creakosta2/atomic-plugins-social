!function(){var e=window.Cocoon;!e&&window.cordova&&"undefined"!=typeof require&&(e=cordova.require("com.ludei.cocoon.common.Cocoon")),e.define("Cocoon.Social",function(t){function n(t){return new e.Social.User(t.playerID,t.alias)}function i(t){return new e.Social.Achievement(t.identifier,t.title,t.achievedDescription,"",t.maximumPoints)}return t.GameCenterExtension=function(){return this.serviceName="LDGameCenterPlugin",this.onGameCenterLoginStateChanged=new e.Signal,this.on=this.onGameCenterLoginStateChanged.expose(),document.addEventListener("deviceready",function(){this.init()}.bind(this)),this},t.GameCenterExtension.prototype={_currentPlayer:null,init:function(){var t=this;e.exec(this.serviceName,"setListener",[],function(e){t._currentPlayer=e,t.onGameCenterLoginStateChanged.emit("loginStatusChanged",[e])})},getSocialInterface:function(){return this._socialService||(this._socialService=new e.Social.SocialGamingServiceGameCenter(this)),this._socialService},getMultiplayerInterface:function(){return new e.Multiplayer.MultiplayerService("LDMultiplayerGameCenterPlugin")},isLoggedIn:function(){return this._currentPlayer&&this._currentPlayer.isAuthenticated},login:function(t){var n=this;e.exec(this.serviceName,"login",[],function(e){n._currentPlayer=e,t&&t(e,null)},function(e){n._currentPlayer=e[0],t&&t(n._currentPlayer,e[1])})},getLocalPlayer:function(){return this._currentPlayer},loadPlayers:function(t,n){e.exec(this.serviceName,"loadPlayers",[t],function(e){n(e,null)},function(e){n(null,e)})},loadFriends:function(t){e.exec(this.serviceName,"loadFriends",[],function(e){t(e,null)},function(e){t(null,e)})},loadAchievements:function(t){e.exec(this.serviceName,"loadAchievements",[],function(e){t(e||[],null)},function(e){t(null,e)})},loadAchievementDescriptions:function(t){e.exec(this.serviceName,"loadAchievementDescriptions",[],function(e){t(e||[],null)},function(e){t(null,e)})},loadScores:function(t,n){e.exec(this.serviceName,"loadScores",[n],function(e){t(e||[],null)},function(e){t(null,e)})},submitScore:function(t,n){e.exec(this.serviceName,"submitScore",[t],function(){n()},function(e){n(e)})},submitAchievements:function(t,n){e.exec(this.serviceName,"submitAchievements",[t],function(){n()},function(e){n(e)})},resetAchievements:function(t){e.exec(this.serviceName,"resetAchievements",[],function(){t()},function(e){t(e)})},showAchievements:function(t){e.exec(this.serviceName,"showAchievements",[],function(){t()},function(e){t(e)})},showLeaderboards:function(t,n){e.exec(this.serviceName,"showLeaderboards",[n],function(){t()},function(e){t(e)})}},t.GameCenter=new t.GameCenterExtension,t.GameCenter.Player=function(){this.playerID="",this.alias="",this.isFriend=!1},t.GameCenter.LocalPlayer=function(){this.playerID="",this.alias="",this.isAuthenticated=!1},t.GameCenter.Achievement=function(e,t){this.identifier=e,this.percentComplete=t,this.lastReportedDate=0},t.GameCenter.AchievementDescription=function(){this.identifier="",this.title="",this.achievedDescription="",this.unachievedDescription="",this.maximumPoints=0},t.GameCenter.Score=function(e,t,n,i,c,r){return this.userID=e,this.score=t||0,this.userName=n,this.imageURL=i,this.leaderboardID=c,this.rank=r.rank,this.originalScoreObject=r,this},t.GameCenter.Leaderboard=function(e,t,n,i,c,r){this.category=e,this.playerIDs=t,this.timeScope=n,this.playerScope=i,this.rangeStart=c,this.rangeLength=r,this.scores=[],this.localPlayerScore=[],this.localizedTitle=localizedTitle},t.GameCenter.TimeScope={TODAY:0,WEEK:1,ALL_TIME:2},t.GameCenter.PlayerScope={GLOBAL:0,FRIENDS:1},t.SocialGamingServiceGameCenter=function(t){e.Social.SocialGamingServiceGameCenter.superclass.constructor.call(this),this.gc=t;var n=this;this.gc.on("loginStatusChanged",function(e,t){n.onLoginStatusChanged.emit("loginStatusChanged",[e&&e.isAuthenticated,t])})},t.SocialGamingServiceGameCenter.prototype={_cachedAchievements:null,isLoggedIn:function(){return this.gc.isLoggedIn()},login:function(e){this.gc.login(function(t,n){e&&e(t&&t.isAuthenticated,n)})},logout:function(e){e&&e({message:"User has to logout from the Game Center APP"})},getLoggedInUser:function(){return n(this.gc._currentPlayer?this.gc._currentPlayer:this.gc.getLocalPlayer())},requestUser:function(e,t){if(t)this.gc.loadPlayers([t],function(t,i){var c=t&&t.length?n(t[0]):null;e(c,i)});else{var i=this;setTimeout(function(){e(i.getLoggedInUser())})}},requestFriends:function(e,t){this.gc.loadFriends(function(t,i){var c=[];if(t&&t.length)for(var r=0;r<t.length;++r)c.push(n(t[r]));e(c,i)})},requestScore:function(t,n){var i={},c=n||{};c.leaderboardID&&(i.category=c.leaderboardID),i.playerIDs=[c.userID||this.getLoggedInUser().userID],this.gc.loadScores(function(n,i){var r=null;c.userID&&n&&n.scores&&n.scores.length?r=n.scores[0]:n&&n.localPlayerScore&&(r=n.localPlayerScore);var o=r?new e.Social.Score(r.playerID,r.value,"","",r.category,r):null;t(o,i)},i)},submitScore:function(e,t,n){var i=n||{};this.gc.submitScore({value:e,category:i.leaderboardID||""},function(e){t&&t(e)})},showLeaderboard:function(e,t){var n=t||{};this.gc.showLeaderboards(function(t){e&&e(t)},{category:n.leaderboardID||""})},prepareAchievements:function(e,t){if(!this._cachedAchievements||e){var n=this;this.gc.loadAchievementDescriptions(function(e,c){if(c)t([],c);else{var r=[];if(e&&e.length)for(var o=0;o<e.length;o++)r.push(i(e[o]));n.setCachedAchievements(r),t(r,null)}})}else t(this._cachedAchievements,null)},requestAllAchievements:function(e){this.prepareAchievements(!0,e)},requestAchievements:function(e,t){var n=this;this.prepareAchievements(!1,function(t,i){return i?void e([],i):void n.gc.loadAchievements(function(t,i){if(i)e([],t.error);else{var c=[];if(t&&t.length)for(var r=0;r<t.length;r++){var o=n.findAchievement(t[r].identifier);o&&c.push(o)}e(c,null)}})})},submitAchievement:function(e,t){if(null===e||"undefined"==typeof e)throw"No achievementID specified";var n=this.translateAchievementID(e);this.gc.submitAchievements([{identifier:n,percentComplete:100}],t)},resetAchievements:function(e){this.gc.resetAchievements(e)},showAchievements:function(e){this.gc.showAchievements(function(t){e&&e(t)})}},e.extend(t.SocialGamingServiceGameCenter,t.SocialGamingService),t})}();